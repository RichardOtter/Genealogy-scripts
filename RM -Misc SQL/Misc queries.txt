
--===========================================DIV50==
show all census events

select PersonID, nt.Surname, nt.Given, et.EventID, ftt.Name
from nameTable as nt
join PersonTable as pt on nt.OwnerID = PersonID
join EventTable as et on et.OwnerID = PersonID
join FactTypeTable as ftt on et.EventType = ftt.FactTypeID
where
    nt.IsPrimary= 1
and et.OwnerType = 0
and ftt.Name = 'Census'


--===========================================DIV50==
--show ID for people with Witness census roles

select pt.PersonID, nt.Surname, nt.Given, substr(et.Date, 4,4), et.EventID, ftt.Name, rt.RoleName
from nameTable as nt
join PersonTable as pt on nt.OwnerID = pt.PersonID
join EventTable as et on et.OwnerID = pt.PersonID
join FactTypeTable as ftt on et.EventType = ftt.FactTypeID
join WitnessTable as wt on wt.EventID = et.EventID
join RoleTable as rt on rt.RoleID = wt.Role
where
    nt.IsPrimary= 1
and et.OwnerType = 0
and ftt.Name = 'Census'
and rt.RoleName = 'witness'


--===========================================DIV50==
-- Display linked people, events, citations

select pt.PersonID, nt.Given, nt.surname, et.EventID, ftt.Name, clt.LinkID, ct.CitationName
from EventTable as et
inner join PersonTable as pt        on pt.PersonID = et.OwnerID
inner join NameTable as nt          on nt.OwnerID = pt.PersonID
inner join FactTypeTable as ftt     on et.EventType = ftt.FactTypeID
inner join CitationLinkTable as clt on clt.OwnerID = et.EventID
inner join CitationTable as ct      on ct.CitationID = clt.CitationID

where et.OwnerType = 0
and   clt.OwnerType = 2
and   nt.IsPrimary = 1
order by pt.PersonID, EventID


--===========================================DIV50==
--Finds events for which the same citation is linked more than once

select pt.PersonID, nt.Given, nt.surname, et.EventID, ftt.Name, ct.CitationID, count(ct.CitationID), ct.CitationName
from EventTable as et
inner join PersonTable as pt        on pt.PersonID = et.OwnerID
inner join NameTable as nt          on nt.OwnerID = pt.PersonID
inner join FactTypeTable as ftt     on et.EventType = ftt.FactTypeID
inner join CitationLinkTable as clt on clt.OwnerID = et.EventID
inner join CitationTable as ct      on ct.CitationID = clt.CitationID

where et.OwnerType = 0
and   clt.OwnerType = 2
and   nt.IsPrimary = 1
--and pt.PersonID=17
group by et.EventID, ct.CitationID

HAVING   count(ct.CitationID) >1
-- order by count(ct.CitationID) DESC
order by ftt.Name DESC


--===========================================DIV50==


